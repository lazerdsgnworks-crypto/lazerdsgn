<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Corporate Homepage</title>
    <!-- Load Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --font-inter: 'Inter', sans-serif;
            /* Slider Speed for Featured Projects (Horizontal) */
            --scroll-speed-h: 40s; 
            
            /* UPDATED: Faster Slider Speeds for Reviews (Vertical) */
            --scroll-speed-v1: 50s; 
            --scroll-speed-v2: 38s; 
            --scroll-speed-v3: 43s; 
            
            --scroll-height: -50%;
        }
        body {
            font-family: var(--font-inter);
            color: #1a1a1a;
            background-color: #ffffff;
        }
        /* Custom styles for the large hero headline */
        .hero-headline {
            font-size: clamp(3rem, 8vw, 5rem);
            line-height: 1.1;
            font-weight: 700;
        }

        /* --- Global Page Transition Animation (NEW) --- */
        .page-transition {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .page-transition.visible {
            opacity: 1;
        }

        /* --- CSS for Featured Projects Slider (Marquee Effect) --- */
        .slider-track {
            display: flex;
            width: fit-content;
            animation: scroll-left var(--scroll-speed-h) linear infinite;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .slider-item {
            width: 320px; 
            flex-shrink: 0;
            margin-right: 1rem;
        }
        .slider-container:hover .slider-track {
            /* Animation pause is now managed via CSS, but not on hover as requested by user */
        }
        /* --- End Featured Projects Slider CSS --- */

        /* --- CSS for Testimonials Vertical Slider (Masonry/Marquee Effect) --- */
        .reviews-scroll-container {
            position: relative;
            height: 700px; /* Fixed height for the visible viewport */
            overflow: hidden;
        }
        /* Fading Mask for the top and bottom */
        .reviews-scroll-container::before,
        .reviews-scroll-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 150px; 
            z-index: 10;
            pointer-events: none;
        }
        .reviews-scroll-container::before {
            top: 0;
            background: linear-gradient(to bottom, #ffffff 30%, rgba(255, 255, 255, 0));
        }
        .reviews-scroll-container::after {
            bottom: 0;
            background: linear-gradient(to top, #ffffff 30%, rgba(255, 255, 255, 0));
        }
        
        .review-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem; 
            width: 100%;
        }
        
        /* Define specific animations for each column to vary the speed */
        .col-1 .review-column { animation: scroll-up-slow var(--scroll-speed-v1) linear infinite; }
        .col-2 .review-column { animation: scroll-up-medium var(--scroll-speed-v2) linear infinite; }
        .col-3 .review-column { animation: scroll-up-fast var(--scroll-speed-v3) linear infinite; }

        @keyframes scroll-up-slow {
            0% { transform: translateY(0); }
            100% { transform: translateY(var(--scroll-height)); }
        }
        @keyframes scroll-up-medium {
            0% { transform: translateY(0); }
            100% { transform: translateY(var(--scroll-height)); }
        }
        @keyframes scroll-up-fast {
            0% { transform: translateY(0); }
            100% { transform: translateY(var(--scroll-height)); }
        }
        /* --- End Testimonials Vertical Slider CSS --- */

        /* --- Chat Specific Styles (MODIFIED) --- */
        .chat-message-container {
            max-width: 80%;
            word-wrap: break-word;
            padding: 0; /* Remove padding from outer container */
            /* Removed align-self: flex-start default */
        }
        
        .chat-message-text {
            padding: 1rem;
            /* Default: no shadow */
        }

        /* User Message Styling (MODIFIED: Light Grey Background, Rounded Corners, Right Alignment) */
        .chat-message-container.user {
            align-self: flex-end;
            /* Ensures container is on the right. Sub-elements are aligned right via flex-col items-end */
        }
        .chat-message-container.user .chat-message-text {
            background-color: #f3f4f6; /* Light gray background */
            color: #1a1a1a;
            box-shadow: none; /* Removed box shadow */
            border-radius: 1rem; /* Fully rounded corners */
            font-weight: 500;
        }
        /* AI Message Styling (MODIFIED: Clean Text look) */
        .chat-message-container.ai {
            align-self: flex-start;
        }
        .chat-message-container.ai .chat-message-text {
            /* Remove background/shadow for "Gemini" look */
            background-color: transparent; 
            color: #1a1a1a;
            box-shadow: none; 
            padding: 0 0 0.25rem 0; /* Minimal padding */
            font-weight: 500;
        }
        
        /* AI Response Fade-in Animation */
        .ai-text-content {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Reset for the loading state to keep it visible */
        .chat-message-container.ai.loading .chat-message-text {
            font-style: italic;
            color: #9ca3af; /* gray-400 */
        }


        /* Action Icons Styling */
        .chat-actions {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            color: #6b7280; /* gray-500 */
            padding: 0.5rem 0 0 0; 
            /* Align actions to the correct side */
        }
        /* User messages action bar MUST align right (right corner below message) */
        .chat-message-container.user .chat-actions {
             justify-content: flex-end;
             padding-right: 0.25rem; /* Small offset for user actions */
        }
        /* AI messages action bar should align left */
        .chat-message-container.ai .chat-actions {
             justify-content: flex-start;
             padding-left: 0.25rem; /* Small offset for AI actions */
        }
        .action-button {
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: color 0.15s;
        }
        .action-button:hover {
            color: #000;
        }
        .action-button.copy {
             margin-left: 0.5rem; /* Separator for buttons */
        }
        .action-button.feedback {
             margin-left: 0.5rem;
        }
        /* Remove specific copy-user rule as actions are now consistently below */

        /* Set the overall chat container height to full screen minus the header height */
        #chat-page {
            height: calc(100vh - 68px); 
            min-height: 500px; /* Ensure a minimum height for usability */
            opacity: 0; /* Start hidden for JS animation */
            transition: opacity 0.3s ease-in-out;
        }
        #chat-page.visible {
            opacity: 1;
        }

        /* Sidebar and Modal styles remain unchanged */

        .session-item-container {
            position: relative;
            padding: 0.3rem 0; /* Reduced vertical padding */
            margin-bottom: 0.25rem; /* Reduced bottom margin */
            color: #1a1a1a;
            font-weight: 400; 
            cursor: pointer;
            overflow: hidden; 
            transition: font-weight 0.2s;
        }
        /* Only change font weight on hover/active */
        .session-item-container:hover, .session-item-container.active {
            font-weight: 500;
        }
        
        .session-text {
            display: inline-block; 
            padding-bottom: 2px;
        }

        .chat-sidebar-header {
            font-weight: 500; 
        }
        /* New Chat Button Styling */
        #new-chat-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: #000;
            color: #fff;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        #new-chat-btn:hover {
            background-color: #333;
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50; /* Above all content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            width: 400px;
            transform: translateY(-50px);
            transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }

    </style>
</head>
<body class="antialiased">
    
    <!-- SVG Icon Definitions (Hidden) -->
    <svg style="display: none;">
        <symbol id="icon-copy" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </symbol>
        <!-- Thumbs Up for Good Response -->
        <symbol id="icon-thumb-up" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M7 10v12h10V10H7zM7 10l-4-4V4h4l3 3m7-3l-4 4v4h4v-4l-4-4z"/>
            <path d="M14 9l1 9"/>
        </symbol>
        <!-- X/Close for Bad Response (More appropriate than Thumbs Down) -->
        <symbol id="icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
        </symbol>
    </svg>

    <!-- Header / Navigation (Visible on both pages) -->
    <header id="main-header" class="sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center h-17">
            <div class="text-2xl font-bold tracking-tight">
                <a href="#" class="text-black" onclick="navigateTo('home', event)">LazerDsgn.</a>
            </div>
            <nav class="hidden md:flex space-x-8 text-sm font-medium text-gray-700 items-center">
                <a href="#" class="hover:text-black" onclick="navigateTo('home', event)">Home</a>
                <a href="#" class="hover:text-black" onclick="navigateTo('portfolio', event)">Portfolio</a>
                <a href="#" class="hover:text-black">Studio</a>
                <!-- Chat link -->
                <a href="#" class="hover:text-black" onclick="navigateTo('chat', event)">Chat</a>
                
                <!-- Login/Logout Link Container -->
                <div id="auth-link-container">
                    <a href="#" class="font-medium text-black border border-gray-300 rounded-full px-4 py-1.5 hover:bg-gray-50 transition" onclick="openModal('login-modal', event)">Login</a>
                </div>
            </nav>
            <button class="md:hidden p-2 rounded-full hover:bg-gray-50">
                <!-- Hamburger Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Homepage Content (Visible by default) -->
    <main id="homepage-content" class="page-transition visible">
        <!-- 2. Hero Section (Image 2) -->
        <section id="hero" class="py-24 md:py-40 text-center">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Launch Article Link -->
                <a href="#" class="inline-flex items-center text-sm font-medium text-gray-800 bg-gray-50 px-4 py-2 rounded-full mb-8 transition hover:shadow-lg">
                    See our latest Brand Review
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                </a>
                
                <!-- Headline -->
                <h1 class="hero-headline tracking-tighter text-black mb-6">
                    Design that makes <br class="hidden sm:block"> your brand pop.
                </h1>

                <!-- Subtext -->
                <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto mb-10">
                    We specialize in sharp, modern graphic design and brand strategy. Stop settling for mediocre visuals and let LazerDsgn create an identity that genuinely connects with your audience.
                </p>

                <!-- CTA Buttons -->
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <!-- UPDATED: Button now navigates to the Portfolio page -->
                    <button class="inline-flex items-center justify-center px-8 py-3 border border-gray-300 text-base font-medium rounded-xl text-black bg-white shadow-sm hover:bg-gray-50 transition" onclick="navigateTo('portfolio', event)">
                        View Projects
                        <!-- Briefcase Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.5 23.5 0 0112 15c-3.185 0-6.279-.83-9-2.245m18 0A23.5 23.5 0 0012 9a23.5 23.5 0 00-9 2.245m18 0V12a3.5 3.5 0 01-3.5 3.5h-5A3.5 3.5 0 018 12v-.745m5-8.255h-2a3.5 3.5 0 00-3.5 3.5v7.5A3.5 3.5 0 0012 21h5.5a3.5 3.5 0 003.5-3.5v-7.5A3.5 3.5 0 0017 4.5z" />
                        </svg>
                    </button>
                    <!-- UPDATED: Sign up button now opens the modal -->
                    <button class="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-xl text-white bg-black shadow-lg hover:bg-gray-800 transition" onclick="openModal('signup-modal', event)">
                        Start Your Project
                        <!-- Arrow Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- 1. Featured Projects Section (Image 1) - White/Black Theme with Slider -->
        <section id="projects" class="py-24 md:py-32 bg-white text-black">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-8">
                    Curating high-impact visual identities.
                </h2>
                <p class="text-xl text-gray-600 max-w-3xl mb-16">
                    LazerDsgn partners with modern brands to develop, accelerate, and invest in integrated portfolios across print, web, and experiential design.
                </p>
            </div>

            <!-- Infinite Project Slider Container -->
            <div class="slider-container overflow-hidden relative">
                <div class="slider-track">
                    
                    <!-- Project Card Content (Repeated twice for seamless loop) -->
                    <!-- Set 1 -->
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/F3F4F6/1F2937?text=Brand+Refresh" alt="Brand Refresh" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Project Nova.</h3><p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">Visual Identity & Strategy.</p></div>
                    </a>
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/000000/ffffff?text=Web+Design" alt="Web Design" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Studio 47.</h3><p class="text-sm text-gray-300 mt-1">UX/UI for a global SaaS platform.</p></div>
                    </a>
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/ffffff/000000?text=Packaging+Design" alt="Packaging Design" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Vector Labs.</h3><p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">Product Packaging and Print.</p></div>
                    </a>
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/808080/000000?text=Advertising+Campaign" alt="Advertising Campaign" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Pulse.</h3><p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">Digital Campaign Creative.</p></div>
                    </a>

                    <!-- Set 2 (Duplicate) -->
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/F3F4F6/1F2937?text=Brand+Refresh" alt="Brand Refresh" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Project Nova.</h3><p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">Visual Identity & Strategy.</p></div>
                    </a>
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/000000/ffffff?text=Web+Design" alt="Web Design" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Studio 47.</h3><p class="text-sm text-gray-300 mt-1">UX/UI for a global SaaS platform.</p></div>
                    </a>
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02]">
                        <img src="https://placehold.co/400x533/ffffff/000000?text=Packaging+Design" alt="Packaging Design" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Vector Labs.</h3><p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">Product Packaging and Print.</p></div>
                    </a>
                    <a href="#" class="slider-item inline-block relative aspect-[3/4] overflow-hidden rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-[1.02] mr-4">
                        <img src="https://placehold.co/400x533/808080/000000?text=Advertising+Campaign" alt="Advertising Campaign" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-75">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4"><h3 class="text-2xl font-semibold text-white">Pulse.</h3><p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">Digital Campaign Creative.</p></div>
                    </a>
                </div>
            </div>
        </section>

        <!-- 4. Testimonials Section (Image 4) - Now with Vertical Infinite Slider -->
        <section id="testimonials" class="py-24 md:py-32 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <span class="text-sm font-medium text-gray-600 bg-gray-50 px-3 py-1.5 rounded-full">Client Success</span>
                    <h2 class="text-4xl md:text-5xl font-extrabold tracking-tighter text-black mt-4 mb-3">
                        What our clients say
                    </h2>
                    <p class="text-lg text-gray-600">
                        Read success stories from brands we've helped elevate.
                    </p>
                </div>

                <!-- Infinite Review Slider Container -->
                <div class="reviews-scroll-container">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 h-full">

                        <!-- Column 1 (Slow Speed - 50s) -->
                        <div class="col-1 overflow-hidden">
                            <div class="review-column">
                                <!-- Review Card 1 (Original) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">LazerDsgn guided our brand through a complex re-design process, providing ongoing expertise and ensuring our final look was pitch perfect.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/9CA3AF/ffffff?text=S" alt="Saman Malik" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Saman Malik</p><p class="text-xs text-gray-500">Brand Director</p></div></div>
                                </div>
                                <!-- Review Card 4 (Original) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The new visual system LazerDsgn delivered instantly elevated our presence in a crowded market. Their process is smooth and highly collaborative.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">A</div><div class="ml-4"><p class="font-semibold text-sm text-black">Ahmed Khan</p><p class="text-xs text-gray-500">Marketing Lead</p></div></div>
                                </div>
                                <!-- Review Card 3 (Original) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">Our website conversions doubled after the UI/UX overhaul. LazerDsgn's focus on user experience married with beautiful design is unmatched.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/1F2937/ffffff?text=H" alt="Hassan Ali" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Hassan Ali</p><p class="text-xs text-gray-500">Digital Strategist</p></div></div>
                                </div>
                                <!-- DUPLICATION START -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">LazerDsgn guided our brand through a complex re-design process, providing ongoing expertise and ensuring our final look was pitch perfect.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/9CA3AF/ffffff?text=S" alt="Saman Malik" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Saman Malik</p><p class="text-xs text-gray-500">Brand Director</p></div></div>
                                </div>
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The new visual system LazerDsgn delivered instantly elevated our presence in a crowded market. Their process is smooth and highly collaborative.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">A</div><div class="ml-4"><p class="font-semibold text-sm text-black">Ahmed Khan</p><p class="text-xs text-gray-500">Marketing Lead</p></div></div>
                                </div>
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">Our website conversions doubled after the UI/UX overhaul. LazerDsgn's focus on user experience married with beautiful design is unmatched.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/1F2937/ffffff?text=H" alt="Hassan Ali" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Hassan Ali</p><p class="text-xs text-gray-500">Digital Strategist</p></div></div>
                                </div>
                                <!-- DUPLICATION END -->
                            </div>
                        </div>

                        <!-- Column 2 (Medium Speed - 38s) -->
                        <div class="col-2 hidden md:block overflow-hidden">
                            <div class="review-column">
                                <!-- Review Card 2 (Original) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The robust design consultation and fast delivery from LazerDsgn have streamlined our production workflow, making our internal marketing significantly more efficient.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/D1D5DB/ffffff?text=Z" alt="Zainab Hussain" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Zainab Hussain</p><p class="text-xs text-gray-500">Creative Manager</p></div></div>
                                </div>
                                <!-- Review Card 5 (Original) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The execution of our campaign assets exceeded expectations. Every touchpoint felt integrated and premium, improving overall brand perception.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">M</div><div class="ml-4"><p class="font-semibold text-sm text-black">Maria Rodriguez</p><p class="text-xs text-gray-500">Founder, Small Retail</p></div></div>
                                </div>
                                <!-- Review Card 1 (Repeat) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">LazerDsgn guided our brand through a complex re-design process, providing ongoing expertise and ensuring our final look was pitch perfect.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/9CA3AF/ffffff?text=S" alt="Saman Malik" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Saman Malik</p><p class="text-xs text-gray-500">Brand Director</p></div></div>
                                </div>
                                <!-- DUPLICATION START -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The robust design consultation and fast delivery from LazerDsgn have streamlined our production workflow, making our internal marketing significantly more efficient.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/D1D5DB/ffffff?text=Z" alt="Zainab Hussain" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Zainab Hussain</p><p class="text-xs text-gray-500">Creative Manager</p></div></div>
                                </div>
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The execution of our campaign assets exceeded expectations. Every touchpoint felt integrated and premium, improving overall brand perception.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">M</div><div class="ml-4"><p class="font-semibold text-sm text-black">Maria Rodriguez</p><p class="text-xs text-gray-500">Founder, Small Retail</p></div></div>
                                </div>
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">LazerDsgn guided our brand through a complex re-design process, providing ongoing expertise and ensuring our final look was pitch perfect.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/9CA3AF/ffffff?text=S" alt="Saman Malik" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Saman Malik</p><p class="text-xs text-gray-500">Brand Director</p></div></div>
                                </div>
                                <!-- DUPLICATION END -->
                            </div>
                        </div>

                        <!-- Column 3 (Fast Speed - 43s) -->
                        <div class="col-3 hidden lg:block overflow-hidden">
                            <div class="review-column">
                                <!-- Review Card 3 (Original) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">Our website conversions doubled after the UI/UX overhaul. LazerDsgn's focus on user experience married with beautiful design is unmatched.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/1F2937/ffffff?text=H" alt="Hassan Ali" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Hassan Ali</p><p class="text-xs text-gray-500">Digital Strategist</p></div></div>
                                </div>
                                <!-- Review Card 4 (Repeat) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The new visual system LazerDsgn delivered instantly elevated our presence in a crowded market. Their process is smooth and highly collaborative.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">A</div><div class="ml-4"><p class="font-semibold text-sm text-black">Ahmed Khan</p><p class="text-xs text-gray-500">Marketing Lead</p></div></div>
                                </div>
                                <!-- Review Card 2 (Repeat) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The robust design consultation and fast delivery from LazerDsgn have streamlined our production workflow, making our internal marketing significantly more efficient.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/D1D5DB/ffffff?text=Z" alt="Zainab Hussain" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Zainab Hussain</p><p class="text-xs text-gray-500">Creative Manager</p></div></div>
                                </div>
                                 <!-- Review Card 5 (Repeat) -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The execution of our campaign assets exceeded expectations. Every touchpoint felt integrated and premium, improving overall brand perception.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">M</div><div class="ml-4"><p class="font-semibold text-sm text-black">Maria Rodriguez</p><p class="text-xs text-gray-500">Founder, Small Retail</p></div></div>
                                </div>
                                <!-- DUPLICATION START -->
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">Our website conversions doubled after the UI/UX overhaul. LazerDsgn's focus on user experience married with beautiful design is unmatched.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/1F2937/ffffff?text=H" alt="Hassan Ali" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Hassan Ali</p><p class="text-xs text-gray-500">Digital Strategist</p></div></div>
                                </div>
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The new visual system LazerDsgn delivered instantly elevated our presence in a crowded market. Their process is smooth and highly collaborative.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">A</div><div class="ml-4"><p class="font-semibold text-sm text-black">Ahmed Khan</p><p class="text-xs text-gray-500">Marketing Lead</p></div></div>
                                </div>
                                <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The robust design consultation and fast delivery from LazerDsgn have streamlined our production workflow, making our internal marketing significantly more efficient.</p>
                                    <div class="flex items-center"><img src="https://placehold.co/40x40/D1D5DB/ffffff?text=Z" alt="Zainab Hussain" class="w-10 h-10 rounded-full object-cover"><div class="ml-4"><p class="font-semibold text-sm text-black">Zainab Hussain</p><p class="text-xs text-gray-500">Creative Manager</p></div></div>
                                </div>
                                 <div class="p-8 bg-white border border-gray-100 rounded-2xl shadow-sm">
                                    <p class="text-gray-700 text-lg mb-6">The execution of our campaign assets exceeded expectations. Every touchpoint felt integrated and premium, improving overall brand perception.</p>
                                    <div class="flex items-center"><div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-semibold text-gray-700">M</div><div class="ml-4"><p class="font-semibold text-sm text-black">Maria Rodriguez</p><p class="text-xs text-gray-500">Founder, Small Retail</p></div></div>
                                </div>
                                <!-- DUPLICATION END -->
                            </div>
                        </div>

                    </div>
                </div>
                <!-- End Infinite Review Slider Container -->

            </div>
        </section>
    </main>

    <!-- Chat Page (Initially Hidden) -->
    <main id="chat-page" class="hidden bg-white w-full overflow-hidden flex flex-col">
        <div class="flex h-full w-full">
            
            <!-- Sidebar (Chat History) -->
            <div id="chat-sidebar" class="w-full sm:w-1/3 lg:w-1/4 xl:w-1/5 min-w-[280px] bg-gray-50 border-r border-gray-200 flex flex-col h-full hidden md:flex">
                
                <!-- Sidebar Header/New Chat Button -->
                <div class="p-4 flex flex-col space-y-4 border-b border-gray-200">
                    <!-- New Chat Button (Expanded GPT Style) -->
                    <button id="new-chat-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                        New Chat
                    </button>
                </div>
                
                <!-- Chat History Container -->
                <div id="chat-history" class="flex-1 overflow-y-auto px-4 py-2 space-y-1">
                    <!-- Chat links dynamically added here by JS -->
                </div>
                
                <!-- Sidebar Footer -->
                <div class="p-4 border-t border-gray-200 text-sm text-gray-600">
                    <!-- Updated to show dynamic user status -->
                    <p id="user-status-text" class="mb-2">Connecting...</p>
                </div>
            </div>
            
            <!-- Main Chat Content Area -->
            <div class="flex-1 flex flex-col overflow-hidden h-full">
                
                <!-- Chat Header/Title (MODIFIED: Removed title and resized header) -->
                <div id="chat-header" class="p-4 border-b border-gray-200 flex items-center bg-white shadow-sm z-10">
                    <div class="flex items-center">
                        <!-- Hamburger button for mobile to show sidebar -->
                        <button class="md:hidden mr-3 p-2 rounded-full hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                        </button>
                        <!-- Title removed -->
                    </div>
                </div>
                
                <!-- Message Display Area -->
                <div id="chat-messages" class="flex-1 overflow-y-auto p-6 md:p-10 flex flex-col space-y-6">
                    <!-- Messages will be injected here -->
                    <div id="default-message" class="text-center text-gray-500 italic pt-20">
                        Start a new chat or click a session on the left to continue a conversation.
                    </div>
                </div>
                
                <!-- Input Area -->
                <div class="p-4 md:p-8 border-t border-gray-200 flex justify-center flex-shrink-0">
                    <div class="w-full max-w-3xl flex items-center bg-white border border-gray-300 rounded-2xl shadow-lg overflow-hidden">
                        <input type="text" id="chat-input" placeholder="Ask a question..." class="flex-1 p-4 text-base border-none focus:ring-0 focus:outline-none placeholder-gray-500 rounded-l-2xl">
                        <button id="send-button" class="bg-black text-white p-4 hover:bg-gray-800 transition rounded-r-2xl">
                            <!-- Send Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
        </div>
    </main>
    <!-- End Chat Page -->

    <!-- NEW: Portfolio Page (Initially Hidden) -->
    <main id="portfolio-page" class="hidden page-transition bg-white w-full overflow-hidden">
        <!-- Portfolio Hero -->
        <section class="py-24 md:py-32 text-center bg-gray-50 border-b border-gray-100">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tighter text-black mb-4">
                    Our Creative Output.
                </h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                    A curated selection of the projects that define LazerDsgn's dedication to impactful visual strategy and cutting-edge design.
                </p>
            </div>
        </section>

        <!-- Portfolio Grid -->
        <section class="py-20 md:py-28">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Filter/Category Bar (optional, minimalist) -->
                <div class="flex flex-wrap justify-center space-x-4 mb-12">
                    <button class="text-sm font-medium text-black border-b-2 border-black pb-1 transition">All Work</button>
                    <button class="text-sm font-medium text-gray-500 hover:text-black transition">Branding</button>
                    <button class="text-sm font-medium text-gray-500 hover:text-black transition">Web Design</button>
                    <button class="text-sm font-medium text-gray-500 hover:text-black transition">Packaging</button>
                </div>

                <!-- Main Grid - Reusing Project Card Styling -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    
                    <!-- Item 1 -->
                    <a href="#" class="group relative aspect-[4/5] overflow-hidden rounded-xl shadow-xl hover:shadow-2xl transition duration-300">
                        <img src="https://placehold.co/800x1000/000000/ffffff?text=E-commerce+UX" alt="Project 1" class="absolute inset-0 w-full h-full object-cover opacity-90 transition-opacity duration-500 group-hover:opacity-100">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-6 left-6 right-6 text-white">
                            <h4 class="text-xl font-semibold mb-1">Aurora Retail Rebrand</h4>
                            <p class="text-sm text-gray-300">Brand Identity, Strategy & E-commerce.</p>
                        </div>
                    </a>

                    <!-- Item 2 -->
                    <a href="#" class="group relative aspect-[4/5] overflow-hidden rounded-xl shadow-xl hover:shadow-2xl transition duration-300">
                        <img src="https://placehold.co/800x1000/F0F0F0/1a1a1a?text=Mobile+App+UI" alt="Project 2" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-90">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-6 left-6 right-6 text-white">
                            <h4 class="text-xl font-semibold mb-1">Zenith Mobile App</h4>
                            <p class="text-sm text-gray-300">Interface Design (UI/UX).</p>
                        </div>
                    </a>

                    <!-- Item 3 -->
                    <a href="#" class="group relative aspect-[4/5] overflow-hidden rounded-xl shadow-xl hover:shadow-2xl transition duration-300">
                        <img src="https://placehold.co/800x1000/D3D3D3/000000?text=Print+Layout" alt="Project 3" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-90">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-6 left-6 right-6 text-white">
                            <h4 class="text-xl font-semibold mb-1">Terra Annual Report</h4>
                            <p class="text-sm text-gray-300">Editorial and Print Design.</p>
                        </div>
                    </a>
                    
                    <!-- Item 4 (Longer Aspect Ratio) -->
                    <a href="#" class="group relative aspect-[5/4] md:col-span-2 overflow-hidden rounded-xl shadow-xl hover:shadow-2xl transition duration-300">
                        <img src="https://placehold.co/1200x960/CCCCCC/1a1a1a?text=Campaign+Creative" alt="Project 4" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-90">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-6 left-6 right-6 text-white">
                            <h4 class="text-xl font-semibold mb-1">Global Campaign Assets</h4>
                            <p class="text-sm text-gray-300">Digital Marketing & Ad Creative.</p>
                        </div>
                    </a>

                    <!-- Item 5 -->
                     <a href="#" class="group relative aspect-[4/5] overflow-hidden rounded-xl shadow-xl hover:shadow-2xl transition duration-300">
                        <img src="https://placehold.co/800x1000/1a1a1a/cccccc?text=Logo+Design" alt="Project 5" class="absolute inset-0 w-full h-full object-cover opacity-90 transition-opacity duration-500 group-hover:opacity-100">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-6 left-6 right-6 text-white">
                            <h4 class="text-xl font-semibold mb-1">Fusion Tech Logo</h4>
                            <p class="text-sm text-gray-300">Modern Logo Development.</p>
                        </div>
                    </a>

                    <!-- Item 6 -->
                    <a href="#" class="group relative aspect-[4/5] overflow-hidden rounded-xl shadow-xl hover:shadow-2xl transition duration-300">
                        <img src="https://placehold.co/800x1000/E5E7EB/000000?text=Website+Mockup" alt="Project 6" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:opacity-90">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-6 left-6 right-6 text-white">
                            <h4 class="text-xl font-semibold mb-1">Apex Corp Landing Page</h4>
                            <p class="text-sm text-gray-300">Conversion-focused Web Design.</p>
                        </div>
                    </a>
                    
                </div>
            </div>
        </section>
    </main>
    <!-- End Portfolio Page -->


    <!-- 3. Footer (Image 3) -->
    <footer id="footer" class="bg-white border-t border-gray-100 pt-16 pb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-12 pb-16">
                
                <!-- Stay Connected / Newsletter -->
                <div class="col-span-2 md:col-span-1">
                    <h3 class="text-3xl font-extrabold tracking-tighter text-black mb-4">Stay <br> Connected</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        Join our newsletter for the latest updates and exclusive offers from LazerDsgn.
                    </p>
                    <div class="flex items-center border border-gray-300 rounded-xl overflow-hidden p-1 bg-white max-w-xs">
                        <input type="email" placeholder="Enter your email" class="w-full px-3 py-2 text-sm border-none focus:ring-0 focus:outline-none placeholder-gray-500">
                        <button class="bg-black text-white p-2 rounded-lg hover:bg-gray-800 transition">
                            <!-- Send Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="font-semibold text-black mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li><a href="#" class="hover:text-black transition" onclick="navigateTo('home', event)">Home</a></li>
                        <li><a href="#" class="hover:text-black transition" onclick="navigateTo('portfolio', event)">Portfolio</a></li>
                        <li><a href="#" class="hover:text-black transition">Studio</a></li>
                        <li><a href="#" class="hover:text-black transition">Services</a></li>
                        <li><a href="#" class="hover:text-black transition">Pricing</a></li>
                        <!-- Chat link updated -->
                        <li><a href="#" class="hover:text-black transition" onclick="navigateTo('chat', event)">Chat</a></li>
                    </ul>
                </div>

                <!-- Contact Us -->
                <div>
                    <h4 class="font-semibold text-black mb-4">Get in Touch</h4>
                    <address class="space-y-2 text-sm not-italic text-gray-600">
                        <p>101 Design Hub</p>
                        <p>Creative City, CC 90210</p>
                        <p>Phone: (555) 789-0123</p>
                        <p>Email: <a href="mailto:hello@lazerdsgn.com" class="hover:text-black transition">hello@lazerdsgn.com</a></p>
                    </address>
                </div>

                <!-- Follow Us / Dark Mode Toggle -->
                <div class="md:text-left">
                    <h4 class="font-semibold text-black mb-4">Follow Us</h4>
                    <div class="flex space-x-3 mb-6">
                        <!-- Social Icons -->
                        <a href="#" class="p-2 border border-gray-300 rounded-full text-gray-600 hover:text-black hover:border-black transition">
                            <!-- Facebook Icon (using simple SVG) -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm3 8h-2v4h2v6h-3v-6h-2V7h2V5h3v2h2v3z"/></svg>
                        </a>
                        <a href="#" class="p-2 border border-gray-300 rounded-full text-gray-600 hover:text-black hover:border-black transition">
                            <!-- Twitter Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm3.333 7.824c.002.046.002.091.002.138 0 1.408-.52 2.76-1.554 3.754-1.034.995-2.39.995-3.424 0a4.846 4.846 0 01-1.554-3.754c.002-.047.002-.092.002-.138a4.846 4.846 0 011.554-3.754c1.034-.995 2.39-.995 3.424 0a4.846 4.846 0 011.554 3.754zM12 6a6 6 0 100 12 6 6 0 000-12z"/></svg>
                        </a>
                        <a href="#" class="p-2 border border-gray-300 rounded-full text-gray-600 hover:text-black hover:border-black transition">
                            <!-- Instagram Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm3.178 4.75a.5.5 0 01.5.5v7.5a.5.5 0 01-.5.5H8.822a.5.5 0 01-.5-.5V7.25a.5.5 0 01.5-.5h6.356zM12 8a4 4 0 100 8 4 4 0 000-8zm0 1.5a2.5 2.5 0 110 5 2.5 2.5 0 010-5z"/></svg>
                        </a>
                        <a href="#" class="p-2 border border-gray-300 rounded-full text-gray-600 hover:text-black hover:border-black transition">
                            <!-- LinkedIn Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm-2 16H8V9h2v9zm-1-10c-1.104 0-2-.896-2-2s.896-2 2-2 2 .896 2 2-.896 2-2 2zm7 10h-2v-4.5c0-.966-.79-1.5-1.5-1.5-.71 0-1.5.534-1.5 1.5V18h-2V9h2v1.442c.49-.692 1.258-1.442 2.5-1.442 1.65 0 3 1.35 3 3V18z"/></svg>
                        </a>
                    </div>
                    
                    <!-- Aesthetic Dark Mode Toggle -->
                    <div class="flex items-center space-x-2">
                        <!-- Sun Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                        
                        <!-- Toggle Switch (Aesthetic representation) -->
                        <div class="relative w-12 h-6 flex items-center bg-gray-200 rounded-full cursor-pointer p-1">
                            <div class="w-4 h-4 rounded-full bg-black shadow-md translate-x-6 transition-transform duration-300"></div>
                        </div>

                        <!-- Moon Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-black" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                    </div>

                </div>
            </div>

            <!-- Copyright and Legal Links -->
            <div class="border-t border-gray-100 pt-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-500">
                <p>&copy; 2024 LazerDsgn. All rights reserved.</p>
                <div class="flex space-x-6 mt-4 md:mt-0">
                    <a href="#" class="hover:text-black transition">Privacy Policy</a>
                    <a href="#" class="hover:text-black transition">Terms of Service</a>
                    <a href="#" class="hover:text-black transition">Cookie Settings</a>
                </div>
            </div>

        </div>
    </footer>
    
    <!-- LOGIN MODAL -->
    <div id="login-modal" class="modal-overlay">
        <div class="modal-content relative">
            <button class="absolute top-4 right-4 text-gray-500 hover:text-black" onclick="closeModal('login-modal')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h3 class="text-3xl font-extrabold mb-6">Log In</h3>
            <!-- Updated form to call loginUser -->
            <form onsubmit="loginUser(event)">
                <div class="mb-4">
                    <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="login-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black transition">
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="login-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black transition">
                </div>
                <p id="login-error-message" class="text-sm text-red-500 mb-4 hidden">Invalid email or password.</p>
                <button type="submit" class="w-full py-3 bg-black text-white font-medium rounded-lg hover:bg-gray-800 transition">
                    Sign In
                </button>
                <p class="text-center text-sm text-gray-500 mt-4">
                    Don't have an account? <a href="#" class="text-black font-medium hover:underline" onclick="closeModal('login-modal'); openModal('signup-modal', event)">Sign up</a>
                </p>
            </form>
        </div>
    </div>

    <!-- SIGNUP MODAL -->
    <div id="signup-modal" class="modal-overlay">
        <div class="modal-content relative">
            <button class="absolute top-4 right-4 text-gray-500 hover:text-black" onclick="closeModal('signup-modal')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h3 class="text-3xl font-extrabold mb-6">Create Account</h3>
            <!-- Updated form to call signupUser -->
            <form onsubmit="signupUser(event)">
                 <div class="mb-4">
                    <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="signup-name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black transition">
                </div>
                <div class="mb-4">
                    <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="signup-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black transition">
                </div>
                <div class="mb-6">
                    <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="signup-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-black focus:border-black transition">
                </div>
                <p id="signup-error-message" class="text-sm text-red-500 mb-4 hidden">Error creating account.</p>
                <button type="submit" class="w-full py-3 bg-black text-white font-medium rounded-lg hover:bg-gray-800 transition">
                    Get Started
                </button>
                <p class="text-center text-sm text-gray-500 mt-4">
                    Already have an account? <a href="#" class="text-black font-medium hover:underline" onclick="closeModal('signup-modal'); openModal('login-modal', event)">Log in</a>
                </p>
            </form>
        </div>
    </div>


    <script type="module">
        // --- FIREBASE IMPORTS (Updated to use standard CDN paths) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // MODIFIED: Added getDocs and where for the new chat session validation logic
        import { getFirestore, collection, query, orderBy, addDoc, onSnapshot, serverTimestamp, doc, updateDoc, setLogLevel, getDocs, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Firebase Debugging (MANDATORY for support) ---
        setLogLevel('debug');

        // --- FIREBASE CONFIGURATION (Using user-provided data) ---
        const firebaseConfig = {
            apiKey: "AIzaSyATQPz3s97OC_T0rBz0l_Tp0cImx_pc-M0",
            authDomain: "lazerdsgn.firebaseapp.com",
            projectId: "lazerdsgn",
            storageBucket: "lazerdsgn.firebasestorage.app",
            messagingSenderId: "382163178225",
            appId: "1:382163178225:web:07cd8aa8d418f52bc44f50",
            measurementId: "G-G8XF6Y8W6Z"
        };
        
        // --- GLOBAL FIREBASE & APP STATE ---
        let app, auth, db, userId = null;
        let activeChatUnsubscribe = null;
        let sessionsUnsubscribe = null;
        
        // --- MODIFICATION: Updated to use Gemini API ---
        const apiKey = ""; // API Key is set to empty string for runtime injection
        const API_MODEL = 'gemini-2.5-flash-preview-05-20';
        const WEBHOOK_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;

        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-lazerdsgn-app';
        const CHATS_COLLECTION = `artifacts/${APP_ID}/users/`; // Base path for user-specific data
        const TEMP_TITLE_PREFIX = 'New Chat -'; // Identifier for new sessions

        // --- GLOBAL HTML ELEMENT REFERENCES ---
        const chatHistoryEl = document.getElementById('chat-history');
        const chatMessagesEl = document.getElementById('chat-messages');
        // const currentChatTitleEl = document.getElementById('current-chat-title'); // REMOVED
        const homePageEl = document.getElementById('homepage-content');
        const chatPageEl = document.getElementById('chat-page');
        const footerEl = document.getElementById('footer');
        const portfolioPageEl = document.getElementById('portfolio-page'); 
        const defaultMessageEl = document.getElementById('default-message');
        const authLinkContainer = document.getElementById('auth-link-container');
        const userStatusText = document.getElementById('user-status-text');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const newChatButton = document.getElementById('new-chat-btn');


        const mainContentPages = {
            'home': homePageEl,
            'chat': chatPageEl,
            'portfolio': portfolioPageEl
        };
        
        // --- UTILITY FUNCTIONS ---
        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        
        /**
         * Copies text to the clipboard, using document.execCommand('copy') which is
         * more reliable in sandboxed environments (iframes).
         * @param {string} text The text content to copy.
         * @param {HTMLElement} btnEl The button element to briefly show success feedback on.
         */
        window.copyToClipboard = function(text, btnEl) {
            const originalHtml = btnEl.innerHTML;
            let success = false;
            
            // 1. Create a temporary textarea element
            const textarea = document.createElement('textarea');
            textarea.value = text;
            // Move off-screen to avoid showing it to the user
            textarea.style.position = 'fixed'; 
            textarea.style.top = '0';
            textarea.style.left = '0';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            
            // 2. Select the text and execute the copy command
            textarea.focus();
            textarea.select();
            
            try {
                success = document.execCommand('copy');
                if (success) {
                    showSuccess();
                } else {
                    console.error('Copy command failed.');
                }
            } catch (err) {
                console.error('Copy failed using execCommand:', err);
            }
            
            // 3. Clean up the temporary element
            document.body.removeChild(textarea);

            function showSuccess() {
                // Show a brief success checkmark
                btnEl.innerHTML = `<svg class="w-4 h-4 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>`;
                setTimeout(() => {
                    btnEl.innerHTML = originalHtml;
                }, 1500);
            }
        };


        // --- FIREBASE INITIALIZATION & AUTH STATE LISTENER ---
        function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // Listen for authentication state changes
                onAuthStateChanged(auth, handleAuthChange);
                
            } catch (error) {
                console.error("Firebase initialization error:", error);
                userStatusText.textContent = "Error: Firebase not initialized.";
            }
        }

        async function handleAuthChange(user) { // Made async to allow firestore call
            // Unsubscribe from old listeners if they exist
            if (sessionsUnsubscribe) sessionsUnsubscribe();
            if (activeChatUnsubscribe) activeChatUnsubscribe();

            if (user) {
                // User is signed in.
                userId = user.uid;
                userStatusText.textContent = `Logged in as: ${user.email}`;
                
                // Update header: show Logout button
                authLinkContainer.innerHTML = `
                    <a href="#" class="font-medium text-black border border-gray-300 rounded-full px-4 py-1.5 hover:bg-gray-50 transition" onclick="logoutUser(event)">Logout</a>
                `;

                // Enable chat and start listening for sessions
                sendButton.disabled = false;
                chatInput.disabled = false;
                newChatButton.disabled = false;
                
                if (userId) {
                    listenForChatSessions();
                    
                    // --- NEW LOGIC: Ensure a default temp chat session exists on initial login/load ---
                    // Wait for sessions to populate
                    await new Promise(resolve => setTimeout(resolve, 500)); 

                    const visibleSessions = chatSessionsData.filter(s => !s.title.startsWith(TEMP_TITLE_PREFIX));
                    
                    // Check if there are no sessions at all (visible or hidden temp sessions)
                    if (chatSessionsData.length === 0) {
                        console.log("No sessions found. Creating initial default temporary session.");
                        await createInitialDefaultSession();
                    } else if (!currentChatId && visibleSessions.length > 0) {
                        // If no chat is loaded, load the most recent visible chat
                        window.loadChatSession(visibleSessions[0].id);
                    }
                    // --- END NEW LOGIC ---

                } else {
                    console.error("Authentication completed, but UID is missing. Cannot start chat listeners.");
                }
                
            } else {
                // User is signed out.
                userId = null;
                userStatusText.textContent = "Please Login or Signup.";
                
                // Update header: show Login button
                authLinkContainer.innerHTML = `
                    <a href="#" class="font-medium text-black border border-gray-300 rounded-full px-4 py-1.5 hover:bg-gray-50 transition" onclick="openModal('login-modal', event)">Login</a>
                `;
                
                // Clear chat history and disable input
                chatHistoryEl.innerHTML = '';
                chatMessagesEl.innerHTML = '';
                currentChatId = null; // Ensure ID is reset on logout
                // currentChatTitleEl.textContent = "Welcome to Chat! Select a session."; // Removed
                // Check if defaultMessageEl exists before trying to access its classList
                if (defaultMessageEl) defaultMessageEl.classList.remove('hidden');
                sendButton.disabled = true;
                chatInput.disabled = true;
                newChatButton.disabled = true;
                
                // Navigate back to home if user was on chat page
                if (!chatPageEl.classList.contains('hidden')) {
                     navigateTo('home');
                }
            }
        }

        async function createInitialDefaultSession() {
            if (!userId) return;

            const sessionsRef = collection(db, `${CHATS_COLLECTION}${userId}/sessions`);
            // Set the identifiable temporary title
            const tempTitle = `${TEMP_TITLE_PREFIX} ${new Date().toLocaleDateString()}`;
            
            try {
                // 1. Create a new session document with the temporary title
                const newSessionRef = await addDoc(sessionsRef, {
                    title: tempTitle,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });
                console.log("Initial default session created:", newSessionRef.id);
                // Immediately load the newly created session
                window.loadChatSession(newSessionRef.id);

            } catch (error) {
                console.error("Error creating initial default chat session:", error);
            }
        }
        
        // --- AUTHENTICATION FUNCTIONS (Made global for inline access) ---
        window.loginUser = async function(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error-message');
            errorEl.classList.add('hidden');
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                window.closeModal('login-modal');
            } catch (error) {
                console.error("Login Error:", error.code, error.message);
                errorEl.textContent = "Invalid email or password.";
                errorEl.classList.remove('hidden');
            }
        }
        
        window.signupUser = async function(event) {
            event.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const errorEl = document.getElementById('signup-error-message');
            errorEl.classList.add('hidden');

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                window.closeModal('signup-modal');
            } catch (error) {
                console.error("Sign Up Error:", error.code, error.message);
                errorEl.textContent = error.message.replace('Firebase:', '');
                errorEl.classList.remove('hidden');
            }
        }
        
        window.logoutUser = function(event) {
            if (event) event.preventDefault();
            signOut(auth).catch((error) => console.error("Logout Error:", error));
        }


        // --- CHAT/FIRESTORE LOGIC ---
        
        let currentChatId = null;
        let chatSessionsData = []; // To store chat metadata (id, title)
        
        function listenForChatSessions() {
            if (!userId) {
                // This case should be caught by handleAuthChange, but we keep it defensive
                console.error("listenForChatSessions called without valid userId.");
                return;
            }
            const sessionsRef = collection(db, `${CHATS_COLLECTION}${userId}/sessions`);
            // NOTE: orderBy is used here. If Firebase indexing errors occur, this must be removed and sorting done in JS.
            const sessionsQuery = query(sessionsRef, orderBy('updatedAt', 'desc')); 

            // Unsubscribe from previous listener if active
            if (sessionsUnsubscribe) sessionsUnsubscribe();

            sessionsUnsubscribe = onSnapshot(sessionsQuery, (snapshot) => {
                chatSessionsData = [];
                snapshot.forEach(doc => {
                    chatSessionsData.push({ id: doc.id, ...doc.data() });
                });
                renderSidebar();
                
            }, (error) => {
                // THIS IS THE ERROR LOCATION: Ensure your Firestore Rules are set correctly!
                console.error("Error fetching chat sessions:", error); 
                chatHistoryEl.innerHTML = `<p class="text-red-500 text-sm p-4">Error loading sessions. Check console for permissions error!</p>`;
            });
        }
        
        function renderSidebar() {
            if (!chatHistoryEl) return;
            chatHistoryEl.innerHTML = ''; 
            
            // MODIFICATION: Filter sessions to hide those that still have the temporary title.
            chatSessionsData
                .filter(session => !session.title.startsWith(TEMP_TITLE_PREFIX))
                .forEach(session => {
                const isActive = session.id === currentChatId;
                
                // Create the container element
                const containerDiv = document.createElement('div');
                containerDiv.className = `session-item-container transition cursor-pointer ${
                    isActive ? 'active' : ''
                }`;
                containerDiv.setAttribute('title', session.title);
                containerDiv.onclick = () => window.loadChatSession(session.id); // Use window.loadChatSession
                
                // Create the text element (actual content)
                const textSpan = document.createElement('span');
                textSpan.className = 'session-text text-sm';
                textSpan.textContent = session.title;
                
                containerDiv.appendChild(textSpan);
                chatHistoryEl.appendChild(containerDiv);
            });
        }

        window.loadChatSession = function(sessionId) {
            if (!userId) {
                console.error("Cannot load chat: User not authenticated.");
                return;
            }
            
            // Unsubscribe from previous message listener if active
            if (activeChatUnsubscribe) activeChatUnsubscribe();

            currentChatId = sessionId;
            renderSidebar(); // Update active highlight

            const session = chatSessionsData.find(s => s.id === sessionId);
            // Use the title from the data if available, otherwise show a default
            const title = session ? session.title : 'Chat Session'; 
            
            // Update the document title/meta title instead of the chat header title
            document.title = `${title} | LazerDsgn Chat`;
            
            if (!chatMessagesEl) return; 
            
            const messagesRef = collection(db, `${CHATS_COLLECTION}${userId}/sessions/${sessionId}/messages`);
            const messagesQuery = query(messagesRef, orderBy('createdAt', 'asc'));

            activeChatUnsubscribe = onSnapshot(messagesQuery, (snapshot) => {
                // --- MODIFICATION: Updated rendering logic to include action icons and new styling ---
                chatMessagesEl.innerHTML = ''; // Clear existing messages before redrawing
                
                if (snapshot.empty) {
                    // MODIFIED: If empty, show default message prompt
                    if (defaultMessageEl) defaultMessageEl.classList.remove('hidden');
                } else {
                     if (defaultMessageEl) defaultMessageEl.classList.add('hidden');
                    snapshot.forEach(doc => {
                        const msg = doc.data();
                        
                        // Outer container for message structure and flex alignment
                        const msgContainer = document.createElement('div');
                        // MODIFIED: Added items-end to user container for right alignment
                        msgContainer.className = `chat-message-container max-w-2xl font-normal w-full ${
                            msg.role === 'user' ? 'self-end flex flex-col items-end' : 'self-start flex flex-col items-start'
                        }`;
                        
                        // Inner text bubble/container
                        const textEl = document.createElement('div');
                        textEl.className = `chat-message-text text-base ${
                            msg.role === 'user' ? 'self-end' : 'self-start'
                        }`;
                        // Add fade-in class for AI messages only
                        if (msg.role === 'ai') {
                             textEl.classList.add('ai-text-content');
                        }
                        textEl.textContent = msg.text; 
                        
                        // Action buttons row
                        const actionsEl = document.createElement('div');
                        actionsEl.className = 'chat-actions';
                        
                        // 1. Copy Button (for both user and AI)
                        const copyBtn = document.createElement('button');
                        copyBtn.className = 'action-button copy';
                        copyBtn.setAttribute('title', 'Copy text');
                        copyBtn.innerHTML = `<svg class="w-4 h-4" aria-hidden="true"><use href="#icon-copy"></use></svg>`;
                        copyBtn.onclick = (e) => window.copyToClipboard(msg.text, copyBtn);
                        
                        // Append text to container
                        msgContainer.appendChild(textEl);

                        if (msg.role === 'user') {
                            // User messages: Actions aligned to the right (end)
                            actionsEl.classList.add('user');
                            actionsEl.appendChild(copyBtn);
                        } else {
                            // AI messages: Actions aligned to the left (start)
                            actionsEl.classList.add('ai');
                            
                            // 2. Good Response
                            const goodBtn = document.createElement('button');
                            goodBtn.className = 'action-button feedback';
                            goodBtn.setAttribute('title', 'Good Response');
                            goodBtn.innerHTML = `<svg class="w-4 h-4" aria-hidden="true"><use href="#icon-thumb-up"></use></svg>`;
                            // 3. Bad Response (using 'close' icon)
                            const badBtn = document.createElement('button');
                            badBtn.className = 'action-button feedback';
                            badBtn.setAttribute('title', 'Bad Response');
                            badBtn.innerHTML = `<svg class="w-4 h-4" aria-hidden="true"><use href="#icon-close"></use></svg>`;
                            
                            actionsEl.appendChild(goodBtn);
                            actionsEl.appendChild(badBtn);
                            actionsEl.appendChild(copyBtn);
                        }

                        msgContainer.appendChild(actionsEl);
                        chatMessagesEl.appendChild(msgContainer);
                    });
                }
                
                // Maintain scroll position after update
                chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;

            }, (error) => {
                 console.error("Error fetching messages:", error);
                 chatMessagesEl.innerHTML = `<p class="text-red-500 text-sm p-4 text-center">Error loading messages. Please check console.</p>`;
            });
        }
        
        window.createNewChatSession = async function() {
            if (!userId) {
                 // Using a custom modal instead of alert
                 openModal('login-modal', null);
                 return;
            }
            
            // --- CHECK: ENSURE CURRENT SESSION HAS USER MESSAGES BEFORE CREATING A NEW ONE ---
            if (currentChatId) {
                const messagesRef = collection(db, `${CHATS_COLLECTION}${userId}/sessions/${currentChatId}/messages`);
                // Query for any message with role 'user'
                const userMessagesQuery = query(messagesRef, where("role", "==", "user"));
                
                try {
                    // Check if any user messages exist in the currently loaded chat
                    const snapshot = await getDocs(userMessagesQuery);
                    
                    if (snapshot.empty) {
                        // If the current chat has no user messages, block creation and reuse the current session.
                        showAlert("Please send at least one message in the current chat before starting a new session.");
                        return;
                    }
                } catch (error) {
                    console.error("Error checking current session for messages:", error);
                    showAlert("Could not verify chat status. Please try again.");
                    return;
                }
            }
            // --- END NEW CHECK ---

            // If currentChatId is null (user is starting from scratch), OR 
            // if the check passed (current chat has user content), proceed with new chat creation.
            
            const sessionsRef = collection(db, `${CHATS_COLLECTION}${userId}/sessions`);
            // Set the identifiable temporary title
            const tempTitle = `${TEMP_TITLE_PREFIX} ${new Date().toLocaleDateString()}`;
            
            try {
                // 1. Create a new session document with the temporary title
                const newSessionRef = await addDoc(sessionsRef, {
                    title: tempTitle,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });

                // 2. Load the new session.
                window.loadChatSession(newSessionRef.id);
                window.navigateTo('chat');

            } catch (error) {
                console.error("Error creating new chat session:", error);
            }
        }
        
        // --- NEW: Title Generation Logic ---
        /**
         * Generates and updates a title for the chat session based on the first user message.
         */
        async function generateChatTitle(sessionId, firstUserMessage) {
            // Trim and truncate the message for a concise title
            let newTitle = firstUserMessage.trim().substring(0, 40);
            if (firstUserMessage.trim().length > 40) {
                newTitle += '...';
            }
            
            // Clean up common symbols
            newTitle = newTitle.replace(/[^\w\s\-\']/gi, '').trim();

            if (!newTitle) {
                newTitle = 'Untitled Session';
            }
            
            try {
                // Update the session document with the new title
                const sessionDocRef = doc(db, `${CHATS_COLLECTION}${userId}/sessions`, sessionId);
                await updateDoc(sessionDocRef, { 
                    title: newTitle,
                    updatedAt: serverTimestamp() // Update timestamp to float to top
                });
                // Rerendering the sidebar here will make the session appear.
                listenForChatSessions(); 
                console.log(`Session ${sessionId} title updated to: ${newTitle}`);

            } catch (error) {
                console.error("Error updating chat session title:", error);
            }
        }
        // --- END NEW LOGIC ---


        // --- WEBHOOK/GEMINI SEND LOGIC (MODIFIED) ---

        window.sendUserMessage = async function() {
            if (!userId) {
                openModal('login-modal', null); 
                return;
            }
            
            const message = chatInput.value.trim();
            if (!message) return;
            
            let sessionIdToUse = currentChatId;
            let isFirstUserMessage = false;

            // --- CRITICAL MODIFICATION: Check if a VALID session is loaded ---
            if (!sessionIdToUse) {
                // If no chat session ID is loaded, force user to explicitly create one via button.
                showAlert("Please click 'New Chat' or select an existing session to begin messaging.");
                return; 
            } else {
                // Get the current title of the loaded session (which is NOT in the DOM anymore, so grab it from data)
                const currentSessionData = chatSessionsData.find(s => s.id === sessionIdToUse);
                const currentSessionTitle = currentSessionData ? currentSessionData.title : '';

                isFirstUserMessage = currentSessionTitle.startsWith(TEMP_TITLE_PREFIX);
            }
            
            // --- START: Add user message to UI immediately for instant feedback ---
            const userMsgContainer = document.createElement('div');
            // MODIFIED: Added flex flex-col items-end for right alignment
            userMsgContainer.className = 'chat-message-container user max-w-2xl font-normal w-full self-end flex flex-col items-end';
            
            const userTextEl = document.createElement('div');
            userTextEl.className = 'chat-message-text text-base self-end';
            userTextEl.textContent = message;
            
            const userActionsEl = document.createElement('div');
            // MODIFIED: User actions explicitly justified right (flex-end)
            userActionsEl.className = 'chat-actions user justify-end';
            const userCopyBtn = document.createElement('button');
            userCopyBtn.className = 'action-button copy';
            userCopyBtn.setAttribute('title', 'Copy text');
            userCopyBtn.innerHTML = `<svg class="w-4 h-4" aria-hidden="true"><use href="#icon-copy"></use></svg>`;
            userCopyBtn.onclick = (e) => window.copyToClipboard(message, userCopyBtn);
            userActionsEl.appendChild(userCopyBtn);
            
            userMsgContainer.appendChild(userTextEl);
            userMsgContainer.appendChild(userActionsEl);

            if (chatMessagesEl) {
                if (defaultMessageEl) defaultMessageEl.classList.add('hidden');
                chatMessagesEl.appendChild(userMsgContainer);
                chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
            }
            // --- END MODIFIED USER MESSAGE ---

            chatInput.value = '';

            const messagesRef = collection(db, `${CHATS_COLLECTION}${userId}/sessions/${sessionIdToUse}/messages`);
            
            try {
                // 1. Save user message to Firestore
                await addDoc(messagesRef, { 
                    text: message, 
                    role: 'user', 
                    createdAt: serverTimestamp() 
                });
                
                // 2. *NEW CALL* If this is the first user message, generate and update the chat title asynchronously
                if (isFirstUserMessage) {
                    generateChatTitle(sessionIdToUse, message);
                }
                
                // 3. Show a loading indicator
                const loadingContainer = document.createElement('div');
                loadingContainer.className = 'chat-message-container ai loading max-w-2xl font-normal w-full self-start flex flex-col';
                const loadingTextEl = document.createElement('div');
                loadingTextEl.className = 'chat-message-text text-base';
                loadingTextEl.textContent = 'Assistant is typing...';
                loadingContainer.appendChild(loadingTextEl);
                
                if (chatMessagesEl) {
                    chatMessagesEl.appendChild(loadingContainer);
                    chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
                }
                
                // --- Use Gemini API for response generation ---
                
                let aiResponseText = 'Error: Failed to fetch response from AI model.';
                const systemPrompt = "You are LazerDsgn's helpful digital assistant, specializing in modern graphic design and brand strategy. Your responses should be concise, professional, and focus on creative topics. Respond directly to the user's last message.";
                
                const payload = {
                    contents: [{ parts: [{ text: message }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    tools: [{ "google_search": {} }] // Enable Google Search grounding
                };
                
                const maxRetries = 3; 

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(WEBHOOK_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            // Check for 403 Forbidden which often indicates an API key issue
                            if (response.status === 403) {
                                throw new Error("Gemini API key error (403 Forbidden). Check key validity.");
                            }
                            throw new Error(`Gemini API HTTP error! Status: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        const candidate = result.candidates?.[0];
                        aiResponseText = candidate?.content?.parts?.[0]?.text || 'Received an empty or malformed response from the AI.';

                        break; 

                    } catch (error) {
                        console.error(`Gemini API attempt ${i + 1} failed:`, error);
                        if (i < maxRetries - 1) {
                            const delay = Math.pow(2, i) * 1000;
                            await sleep(delay);
                        } else {
                            aiResponseText = `Final AI connection error after ${maxRetries} attempts: ${error.message}`;
                        }
                    }
                }
                // --- END MODIFICATION ---
                
                // 5. Remove loading indicator and save AI response to Firestore
                loadingContainer.remove();

                await addDoc(messagesRef, { 
                    text: aiResponseText, 
                    role: 'ai', 
                    createdAt: serverTimestamp() 
                });

                // Update session timestamp for sorting
                const sessionDocRef = doc(db, `${CHATS_COLLECTION}${userId}/sessions`, sessionIdToUse);
                await updateDoc(sessionDocRef, { updatedAt: serverTimestamp() });

            } catch (error) {
                console.error("Error sending message or saving to Firestore:", error);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'chat-message-container ai max-w-2xl font-normal w-full self-start flex flex-col';
                errorDiv.innerHTML = `<div class="chat-message-text text-base text-red-500">Error: ${error.message}</div>`;
                if(chatMessagesEl) chatMessagesEl.appendChild(errorDiv);
            }
        }


        // --- MODAL LOGIC (Made global for inline access) ---
        // NOTE: A simple text placeholder is required here since we can't use alert()
        const alertPlaceholder = document.createElement('div');
        alertPlaceholder.className = 'fixed bottom-4 right-4 bg-red-600 text-white p-3 rounded-lg shadow-xl z-50 transition-opacity duration-300 opacity-0 pointer-events-none';
        document.body.appendChild(alertPlaceholder);

        function showAlert(message) {
            alertPlaceholder.textContent = message;
            alertPlaceholder.classList.remove('opacity-0', 'pointer-events-none');
            alertPlaceholder.classList.add('opacity-100');
            setTimeout(() => {
                alertPlaceholder.classList.remove('opacity-100');
                alertPlaceholder.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }

        window.openModal = function(id, event) { 
            if (event && typeof event.preventDefault === 'function') { 
                event.preventDefault();
            }
            const modal = document.getElementById(id);
            if (modal) {
                // Clear previous errors
                if (id === 'login-modal') document.getElementById('login-error-message').classList.add('hidden');
                if (id === 'signup-modal') document.getElementById('signup-error-message').classList.add('hidden');
                
                modal.classList.add('open');
            }
        }

        window.closeModal = function(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('open');
            }
        }


        // --- NAVIGATION LOGIC (Made global for inline access) ---
        window.navigateTo = function(page, event) {
            if (event) {
                event.preventDefault();
            }
            
            // Primary check: Ensure auth is initialized and user is present for chat access
            if (page === 'chat') {
                if (!auth || !auth.currentUser) {
                    window.openModal('login-modal', event); 
                    return;
                }
            }

            const targetEl = mainContentPages[page];
            if (!targetEl) return;

            Object.values(mainContentPages).forEach(el => {
                if (el) {
                    el.classList.add('hidden');
                    el.classList.remove('visible');
                }
            });
            footerEl.classList.add('hidden');

            targetEl.classList.remove('hidden');
            
            setTimeout(() => {
                targetEl.classList.add('visible');
            }, 10);
            
            if (page === 'chat') {
                // MODIFIED: No title update needed, title is hidden.

                // Load the most recent visible session if no chat is currently loaded.
                if (!currentChatId) {
                    const visibleSessions = chatSessionsData.filter(s => !s.title.startsWith(TEMP_TITLE_PREFIX));
                    if (visibleSessions.length > 0) {
                        window.loadChatSession(visibleSessions[0].id);
                    } else {
                        // If no visible sessions and no currentId, load the *most* recent session (which must be the temp one)
                         if (chatSessionsData.length > 0) {
                            window.loadChatSession(chatSessionsData[0].id);
                        } else {
                            // This scenario should be rare if handleAuthChange works correctly, but handles the true zero-state.
                            if (defaultMessageEl) defaultMessageEl.classList.remove('hidden');
                        }
                    }
                } 
            } else { // 'home' or 'portfolio'
                footerEl.classList.remove('hidden');
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();

            // Setup send button event listener
            sendButton.addEventListener('click', window.sendUserMessage);

            // Allow sending with Enter key
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    window.sendUserMessage();
                }
            });
            
            // Handle the "New Chat" button functionality
            newChatButton.addEventListener('click', window.createNewChatSession);
        });
    </script>

</body>
</html>
